# Example docker-compose.yml for running rlpx-proxy with an XDC node.
#
# Setup:
#   1. cd example/
#   2. cp .env.example .env  (fill in your keys)
#   3. Create a static-nodes.json with enode URLs to connect to
#   4. docker compose up -d --build
#
# The rlpx-proxy Dockerfile is in the parent directory (the Go project root).

services:
  xdc-node:
    build:
      context: .
      dockerfile: Dockerfile.xdc-arm64
    image: xdposchain-arm64:v2.6.8
    expose:
      - "30303/tcp"
    ports:
      - "30303:30303/udp"
      - "8545:8545"
    environment:
      - NETWORK=mainnet
      - PRIVATE_KEY=${ACCOUNT_KEY}
      - XDC_NODEKEYHEX=${NODE_P2P_KEY}
    volumes:
      - ./xdc-data:/work/xdcchain

  rlpx-proxy:
    build:
      context: ..
      dockerfile: Dockerfile
    ports:
      - "30303:30303/tcp"
    environment:
      - NODE_PRIVATE_KEY=${NODE_P2P_KEY}
      - UPSTREAM_HOST=xdc-node
      - UPSTREAM_PORT=30303
      - PEERS_FILE=/etc/rlpx-proxy/peers.json
      - MAX_OUTBOUND=10
    volumes:
      - ./static-nodes.json:/etc/rlpx-proxy/peers.json:ro
    depends_on:
      - xdc-node
