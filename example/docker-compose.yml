# docker-compose.yml for running rlpx-proxy as a standalone peer monitor.
#
# The XDC node is optional â€” the monitor can run standalone with just bootnodes.
#
# Setup:
#   1. cd example/
#   2. cp .env.example .env  (fill in your keys)
#   3. docker compose up -d --build
#
# Standalone (no XDC node):
#   docker compose up -d --build rlpx-proxy

services:
  xdc-node:
    build:
      context: .
      dockerfile: Dockerfile.xdc-arm64
    image: xdposchain-arm64:v2.6.8
    restart: unless-stopped
    profiles:
      - with-upstream
    expose:
      - "30303/tcp"
    ports:
      - "30303:30303/udp"
      - "8545:8545"
    environment:
      - NETWORK=mainnet
      - PRIVATE_KEY=${ACCOUNT_KEY}
      - XDC_NODEKEYHEX=${NODE_P2P_KEY}
      - SYNC_MODE=full
      - GC_MODE=archive
    volumes:
      - xdc-data:/work/xdcchain
      - ./start-xdc.sh:/work/start.sh:ro

  rlpx-proxy:
    build:
      context: ..
      dockerfile: Dockerfile
    restart: unless-stopped
    ports:
      - "30303:30303/tcp"
      - "30301:30301/udp"
      - "8080:8080"
    environment:
      - NODE_PRIVATE_KEY=${NODE_P2P_KEY}
      - DISCOVERY_ADDR=:30301
      - MAX_OUTBOUND=${MAX_OUTBOUND:-100}
      - PROPAGATE=${PROPAGATE:-true}
      - API_ADDR=:8080
      - BOOTNODES_FILE=/bootnodes.txt
    volumes:
      - ./xdc-bootnodes.txt:/bootnodes.txt:ro

volumes:
  xdc-data:
