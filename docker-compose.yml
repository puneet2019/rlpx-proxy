services:
  xdc-peer-sniffer:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: xdc-peer-sniffer
    # Capture traffic related to XDC communications
    command: ["start2", "--track-handshakes=true", "--output=json", "--xdc-only=true"]
    network_mode: "host"  # Required for packet capture on all interfaces
    volumes:
      - ./peerd-data:/root/.peerd  # Mount volume to persist peer data
      # Optional: Mount cgroup filesystem for advanced container identification
      # - /sys/fs/cgroup:/sys/fs/cgroup:ro
    cap_add:
      - NET_ADMIN
      - NET_RAW
    privileged: true  # Required for packet capture
    restart: unless-stopped
    environment:
      - HOME=/root
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

  xdc-node:  # Your XDC node service
    image: xinfinorg/xdposchain:v2.6.8  # Replace with your actual XDC node image
    container_name: xdc-node
    environment:
      - NETWORK=mainnet
      - PRIVATE_KEY=e7064463b0d8670605f55f2ee4f7718eb17f4827b6b7f72ddaa88e8d03df15c2
    ports:
      - "30303:30303/tcp"
      - "30303:30303/udp"
      - "8545:8545"  # RPC port
      - "8546:8546"  # WebSocket port
    volumes:
      - ./xdc-data:/root/.xdc  # Mount for XDC node data
      - ./peerd-data:/root/.peerd  # Share peer data with sniffer
    restart: unless-stopped
    depends_on:
      - xdc-peer-sniffer
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"